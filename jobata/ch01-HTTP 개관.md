# 1장 HTTP 개관

## CONTENTS
- [HTTP 인터넷의 멀티미디어 배달부](#HTTP-인터넷의-멀티미디어-배달부)
- [웹 클라이언트와 서버](#웹-클라이언트와-서버)
- [리소스](#리소스)
- [트랜잭션](#트랜잭션)
- [메시지](#메시지)
- [TCP 커넥션](#TCP-커넥션)
- [프로토콜 버전](#프로토콜-버전)
- [웹의 구성요소](#웹의-구성요소)

### HTTP 인터넷의 멀티미디어 배달부
- http
  - 전 세계의 웹 서버로부터 대량의 정보를 빠르고, 간편하고, 정확하게 사람들의 PC에 설치된 웹 브라우저로 옮겨준다.
  - 신뢰성 있는 데이터 전송 프로토콜
    - 전송 중 파괴되거나, 중복되거나, 왜곡되는 것을 걱정하지 않아도 된다.
    - 개발자는 인터넷의 결함이나 약점에 대한 걱정 없이 애플리케이션 고유의 기능을 구현하는데 집중할 수 있다.

### 웹 클라이언트와 서버
- 클라이언트는 서버에 http 요청을 보내고 서버는 요청된 데이터를 http 응답으로 돌려준다.
  - 예시) "http://www.oreilly.com/index.html" 페이지를 열어볼 때
    - 웹 브라우저는 http 요청을 www.oreilly.com 서버로 보낸다.
    - 서버는 요청 받은 객체 /index.html 을 찾고, 성공했다면 그것의 타입, 길이 등의 정보와 함께 http 응답에 실어서 클라이언트에게 보낸다. 

### 리소스
- [웹 리소스](https://developer.mozilla.org/ko/docs/Web/HTTP/Basics_of_HTTP/Identifying_resources_on_the_Web)
  - 웹 서버가 관리하고 제공한다.
  - 웹 콘텐츠의 원천
  - 웹 서버 파일 시스템의 정적 파일
    - 텍스트, html, 워드, 이미지, 동영상 등
  - 동적 컨텐츠 리소스
    - 요청에 따라 컨텐츠를 생산
- 미디어 타입
  - MIME(Multipurpose Internet Mail Extensions, 다목적 인터넷 메일 확장) 타입
    - http는 웹에서 전송되는 객체 각각에 신중하게 MIME 타입이라는 데이터 포맷 라벨을 붙인다.
    - 웹 브라우저는 서버로부터 객체를 돌려받을 때, 다룰 수 있는 객체인지 MIME 타입을 통해 확인한다.
    - 사선(/)으로 구분된 주 타입(primary object type)과 부 타입(specific subtype)으로 이루어진 문자열 라벨
      - text/html, application/json, image/jpeg ...
- URI
  - uniform resource identifier(통합 자원 식별자)
  - 웹 서버 리소스는 각자 이름을 갖고 있기 때문에 클라이언트는 관심 있는 리소스를 지목할 수 있다.
  - 인터넷의 우편물 주소 같은 것으로, 정보 리소스를 고유하게 식별하고 위치를 지정할 수 있다.
  - URI에는 URL과 URN이 있다.
  - 예) '죠의 컴퓨터 가게'의 웹 서버에 있는 이미지 리소스에 대한 URI
    - http://www.joes-hardware.com/specials/saw-blade.gif
    - http 프로토콜에서 어떻게 해석될까?
      1. http 프로토콜을 사용하라.
      2. www.joes-harware.com 으로 이동하라.
      3. /splecials/saw-blade.gif라고 불리는 리소스를 가져와라.
- URL
  - uniform resource locator(통합 자원 지시자)
  - 리소스 식별자의 가장 흔한 형태
  - 특정 서버의 한 리소스에 대한 구체적인 위치를 서술
    - 리소스가 정확히 어디에 있고 어떻게 접근할 수 있는지 분명히 알려준다.
  - 표준 포맷
    - 프로토콜, 서버, 리소스를 명시한다.
    - URL의 첫 번째 부분은 scheme(스킴)이라고 불린다.
      - 리소스에 접근하기 위해 사용되는 프로토콜을 서술한다. (http, ftp, ...)
    - 두 번째 부분은 서버의 인터넷 주소를 제공한다.
    - 마지막은 웹 서버의 리소스르 가리킨다.
- URN
  - uniform resource name(유니폼 리소스 이름)
  - 콘텐츠를 이루는 한 리소스에 대해, 그 리소스의 위치에 영향 받지 않는 유일무이한 이름 역할
  - 위치 독립적인 URN은 리소스를 여기저기로 옮기더라도 문제없이 동작
  - 리소스가 이름을 변하지 않게 유지하는 한, 여러 종류의 네트워크 접속 프로토콜로 접근해도 문제 없다.
  - 예) urn:ietf:rfc:2141
    - 인터넷 표준문서 RFC 2141가 어디에 있거나 상관없이 그것을 지칭하기 위해 사용할 수 있다.

### 트랜잭션
- http 트랜잭션
  - 요청 명령과 응답 결과로 구성되어 있다.
    - http 요청 메시지는 명령과 uri를 포함한다.
      ```
      GET /specials/saw-balde.gif HTTP/1.0
      Host: www.joes-hardware.com
      ```
    - http 응답 메시지는 트랜잭션의 결과를 포함한다.
      ```
      HTTP/1.0 200 OK
      Content-type: image/gif
      Content-length: 8572
      ```
- 메서드
  - http는 http 메서드라 불리는 여러 가지 종류의 요청 명령을 지원한다.
  - 모든 http 요청 메시지는 한 개의 메서드를 갖는다.
  - 서버에게 어떤 동작이 취해져야 하는지 말해준다.
  - [http 요청 메서드](https://developer.mozilla.org/ko/docs/Web/HTTP/Methods)
    - GET
      - GET 메서드는 특정 리소스의 표시를 요청합니다. GET을 사용하는 요청은 오직 데이터를 받기만 합니다.
    - HEAD
      - HEAD 메서드는 GET 메서드의 요청과 동일한 응답을 요구하지만, 응답 본문을 포함하지 않습니다.
    - POST
      - POST 메서드는 특정 리소스에 엔티티를 제출할 때 쓰입니다. 이는 종종 서버의 상태의 변화나 부작용을 일으킵니다.
    - PUT
      - PUT 메서드는 목적 리소스 모든 현재 표시를 요청 payload로 바꿉니다.
    - DELETE
      - DELETE 메서드는 특정 리소스를 삭제합니다.
    - CONNECT
      - CONNECT 메서드는 목적 리소스로 식별되는 서버로의 터널을 맺습니다.
    - OPTIONS
      - OPTIONS 메서드는 목적 리소스의 통신을 설정하는 데 쓰입니다.
    - TRACE
      - TRACE 메서드는 목적 리소스의 경로를 따라 메시지 loop-back 테스트를 합니다.
    - PATCH
      - PATCH 메서드는 리소스의 부분만을 수정하는 데 쓰입니다.
- 상태 코드
  - 모든 http 응답 메시지는 상태 코드와 함께 반환된다.
  - 클라이언트에게 요청이 성공했는지 아니면 추가 조치가 필요한지 알려주는 세 자리 숫자다.
  - 각 숫자 상태 코드에 텍스트로된 사유 구절(reason phrase)도 함께 보낸다.
    - 이 구문은 단지 설명만을 위해서 포함된 것일 뿐 실제 응답 처리에는 숫자로 된 코드가 사용된다.
  - 정리
    - 100~199 - 정보성 상태 코드
    - 200~299 - 성공 상태 코드
    - 300~399 - 리다이렉션 상태 코드
    - 400~499 - 클라이언트 에러 상태 코드
    - 500~599 - 서버 에러 상태 코드
- 웹페이지는 여러 객체로 이루어질 수 있다.
  - 애플리케이션은 보통 하나의 작업을 수행하기 위해 여러 http 트랜잭션을 수행한다.
  - 웹 페이지는 보통 하나의 리소스가 아닌 리소스의 모음이다.
    - html, 이미지, 그래픽 조각, 자바 애플릿, ...
    - 웹 페이지는 첨부된 리소스들에 대해 각각 별개의 http 트랜잭션을 필요로 한다.

### 메시지
- [http 메시지](https://developer.mozilla.org/ko/docs/Web/HTTP/Messages)
  - 단순한 줄 단위의 문자열
  - 이진 형식이 아닌 일반 텍스트
  - 요청 메시지
    ```
    GET /test/hi-there.txt HTTP/1.0  // 시작줄
    Accept: text/*                   // 헤더
    Accept-Language: en,fr           // 헤더
                                     // 헤더
    ```
  - 응답 메시지
    ```
    HTTP/1.0 200 OK                  // 시작줄
    Content-type: text/plain         // 헤더
    Content-length: 19               // 헤더
                                     // 헤더
    Hi! I'm a message!               // 본문
    ```
  - 구조
    - 시작줄
      - 메시지의 첫 줄은 시작줄로 요청이라면 무엇을 해야 하는지 응답이라면 무슨 일이 일어났는지 나타낸다.
    - 헤더
      - 시작줄 다음에는 0개 이상의 헤더 필드가 이어진다.
      - 각 헤더 필드는 쉬운 구문분석을 위해 쌍점(:)으로 구분되어 있는 하나의 이름과 하나의 값으로 구성된다.
      - 헤더 필드를 추가하려면 그저 한 줄을 더하기만 하면 된다.
      - 헤던는 빈 줄로 끝난다.
    - 본문
      - 빈 줄 다음에는 어떤 종류의 데이터든 들어갈 수 있는 메시지 본문이 필요에 따라 올 수 있다.
      - 요청의 본문은 웹 서버로 데이터를 실어 보내며, 응답의 본문은 클라이언트로 데이터를 반환한다.
      - 문자열이며 구조적인 시작줄이나 헤더와 달리, 본문은 임의의 이진 데이터를 포함할 수 있다.
        - 이미지, 비디오, 오디오, 응용 소프트웨어
      - 물론 텍스트도 포함할 수 있다.

### TCP 커넥션
- 어떻게 메시지가 TCP(Transmission Control Protocol, 전송 제어 프로토콜) 커넥션을 통해 한 곳에서 다른 곳으로 옮겨가는지 잠깐 이야기해보도록 하자.
- http는 애플리케이션 계층 프로토콜이다.
  - http는 네트워크 통신의 핵심적인 세부사항에 대해선 신경 쓰지 않는다.
  - 대중적이고 신뢰성 있는 인터넷 전송 프로토콜인 TCP/IP에 맡긴다.
- TCP/IP
  - TCP는 다음을 제공한다.
    - 오류 없는 데이터 전송
    - 순서에 맞는 전달 (데이터는 언제나 보낸 순서대로 도착한다.)
    - 조각나지 않는 데이터 스트림 (엔저든 어떤 크기로든 보낼 수 있다.)
  - TCP와 IP가 층을 이루는, 패킷 교환 네트워크 프로토콜의 집합이다.
  - 각 네트워크와 하드웨어의 특성을 숨기고, 어떤 종류의 컴퓨터나 네트워크든 서로 신뢰성 있는 의사소통을 하게 해 준다.
    - 일단 TCP 커넥션이 맺어지면, 클라이언트와 서버 컴퓨터 간에 교환되는 메시지가 없어지거나, 손상되거나, 순서가 뒤바뀌어 수신되는 일은 결코 없다.
  - HTTP 네트워크 프로토콜 스텍
    - HTTP - 애플리케이션 계층
    - TCP - 전송 계층
    - IP - 네트워크 계층
    - 네트워크를 위한 링크 인터페이스 - 데이터 링크 계층
    - 물리적인 네트워크 하드웨어 - 물리 계층
  - 네트워크 개념상 http 프로토콜은 tcp 위의 계층이다. http는 자신의 메시지 데이터를 전송하기 위해 tcp를 사용한다. 이와 유사하게 tcp는 ip 위의 계층이다.
- 접속, IP 주소 그리고 포트번호
  - http 클라이언트가 서버에 메시지를 전송할 수 있게 되기 전에 IP(internet protocol) 주소와 포트번호를 사용해 클라이언트와 서버 사이에 tcp/ip 커넥션을 맺어야 한다.
  - tcp에서는 서버 컴퓨터에 대한 ip 주소와 그 서버에서 실행 중인 프로그램이 사용 중인 포트번호가 필요하다.
    - 어떻게 http 서버의 ip 주소와 포트 번호를 알 수 있을까? url(리소스에 대한 주소)을 이용하면 된다.
      - http://207.200.83.29:80/index.html
        - ip 주소 208.200.83.29와 포트번호 80을 갖고 있다.
      - http://www.netscape.com:80/index.html
        - ip 주소 대신 글자로된 도메인 이름 혹은 호스트명을 갖고 있다.
        - 호스트 명은 ip 주소에 대한 이해하기 쉬운 형태의 별명이다.
        - DNS라 불리는 장치를 통해 쉽게 ip로 변환될 수 있다.
      - http://www.netscape.com/index.html
        - 포트번호가 빠진 경우에는 기본값 80이라고 가정하면 된다.
  - 웹 브라우저 연결의 기본적인 절차
    - 웹 브라우저는 서버의 URL에서 호스트 명을 추출한다.
    - 웹 브라우저는 서버의 호스트 명을 DNS를 통해 IP로 변환한다.
    - 웹 브라우저는 URL에서 포트번호(있다면)를 추출하낟.
    - 웹 브라우저는 웹 서버와 TCP 커넥션을 맺는다.
    - 웹 브라우저는 서버에 HTTP 요청을 보낸다.
    - 서버는 웹브라우저에 HTTP 응답을 돌려준다.
    - 커넥션이 닫히면, 웹브라우저는 문서를 보여준다.

### 프로토콜 버전
- HTTP/0.9
  - 1991년의 HTTP 프로토타입
  - 심각한 디자인 결함이 다수 있고 구식 클라이언트하고만 같이 사용할 수 있다.
  - 오직 GET 메서드만 지원하고 멀티미디어 콘텐츠에 대한 MIME 타입이나 http 헤더, 버전 번호는 지원하지 않는다.
  - 원래 간단한 html 객체를 받아 오기 위해 만들어진 것이다.
  - 금방 HTTP/1.0으로 대체되었음
- HTTP/1.0
  - 처음으로 널리 쓰이기 시작한 http 버전
  - 버전 번호, http 헤더, 추가 메서드, 멀티미디어 객체 처리를 추가했다.
  - 시작적으로 매력적인 웹페이지와 상호작용하는 폼을 실현했고 www을 대세로 만들었다.
  - but, 결코 잘 정의된 명세가 아니다.
    - http가 상업적, 학술적으로 급성장하던 시기에 만들어진, 잘 동작하는 용례들의 모음에 가깝다.
- HTTP/1.0+
  - 1990년대 중반, www이 급격히 팽창하고 상업적으로도 성공하면서 여러 유명 웹 클라이언트와 서버들은 그에 따른 요구를 만족시키기 위해 발 빠르게 http에 기능을 추가해갔다.
  - keep-alive 커넥션, 가상 호스팅 지원, 프락시 연결 지원 등 공식적이진 않지만 사실상의 표준으로 http에 추가되었다.
  - 이 규격 외에 확장된 http 버전을 흔히 HTTP/1.0+라 부른다.
- HTTP/1.1
  - http 설계의 구조적 결함 교정, 두드러진 성능 최적화, 잘못된 기능 제거에 집중
  - 더 복잡해진 애플리케이션과 배포를 지원한다.
  - 현재의 http 버전이다.
- [HTTP/2.0](https://developers.google.com/web/fundamentals/performance/http2?hl=ko)
  - HTTP/1.1 성능 문제를 개선하기 위해 구글의 SPDY 프로토콜을 기반으로 설계
  - 성능이 개선되고 요청 우선순위 지정, 흐름 제어, 서버 푸시와 같은 새로운 기능들이 제공된다.

### 웹의 구성요소
- 프락시
  - 클라이언트와 서버 사이에 위치한 http 중개자
  - 웹 보안, 애플리케이션 통합, 성능 최적화를 위한 중요한 구성요소
- 캐시
  - 많이 찾는 웹페이지를 클라이언트 가까이에 보관하는 http 창고
  - 특별한 종류의 http 프락시 서버
  - 클라이언트는 멀리 떨어진 웹 서버보다 근처의 캐시에서 훨씬 더 빨리 문서를 다운 받을 수 있다.
- 게이트웨이
  - 다른 애플리케이션과 연결된 특별한 웹 서버
  - 다른 서버들의 중개자로 동작하는 특별한 서버
  - http 트래픽을 다른 프로토콜로 변환하기 위해 사용된다.
  - 게이트웨이는 언젠나 스스로가 리소스를 갖고 있는 진짜 서버인 것처럼 요청을 다룬다.
    - 클라이언트는 자신이 게이트웨이와 통신하고 있음을 알아채지 못할 것이다.
- 터널
  - 단순 http 통신을 전달하기만 하는 특별한 프락시
  - 두 커넥션 사이에서 raw 데이터를 열어보지 않고 그대로 전달해주는 http 애플리케이션
  - 주로 비 http 데이터를 하나 이상의 http 연결을 통해 그대로 전송해주기 위해 사용된다.
  - 예) 암호화된 SSL 트래픽을 http 커넥션으로 전송함으로써 웹 트래픽만 허용하는 사내 방화벽을 통과시키는 것
    - 클라이언트 -> SSL -> 터널 시작 -> HTTP/SSL -> HTTP 커넥션 -> HTTP/SSL -> 80번 포트, 터널 끝 -> SSL -> SSL 커넥션 -> SSL -> 443번 포트, 서버
    - HTTP/SSL 터널은 http 요청을 받아들여 목적지의 주소와 포트번ㄴ호로 컨넥션을 맺는다.
    - 이후부터는 암호화된 SSL 트래픽을 http 채널을 통해 목적지 서버로 전송할 수 있게 된다.
- 에이전트
  - 자동화된 http 요청을 만드는 준지능적 웹클라이언트
  - 사용자 에이전트는 사용자를 위해 http 요청을 만들어주는 클라이언트 프로그램이다.
  - 웹 요청을 만드는 애플리케이션은 뭐든 http 에이전트이다.
  - 웹브라우저, 스파이더, 웹로봇, ...
