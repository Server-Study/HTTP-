# 3장 HTTP 메시지

## CONTENTS
- [메시지의 흐름](#메시지의-흐름)
- [메시지의 각 부분](#메시지의-각-부분)
- [메서드](#메서드)
- [상태 코드](#상태-코드)
- [헤더](#헤더)

### 메시지의 흐름
- 메시지의 방향을 의미하는 용어
  - 인바운드
    - 메시지가 원 서버로 향하는 것
    - 서버 내부로 들어오는 것
    - 서버 또는 네트워크 내부로 인입
    - 클라이언트 => 서버
    - 클라이언트가 업로드할 때
    - 요청 메시지
  - 아웃바운드
    - 메시지가 사용자 에이전트로 돌아오는 것
    - 서버 바깥으로 나가는 것
    - 서버 또는 네트워크 존 외부로 송출
    - 서버 => 클라이언트
    - 클라이언트가 다운로드할 때
    - 응답 메시지
  - 업스트림
    - 클라이언트에서 서버로 전송되는 데이터 또는 보내는 것
  - 다운스트림
    - 서버에서 클라이언트로 전송되는 데이터의 흐름
- http 메시지는 요청 메시지냐 응답 메시지냐 관계 없이 다운스트림으로 흐른다??
  - 여기서 말하는 다운스트림은 위에서 지칭하는 다운스트림과는 의미가 다른 것 같다.
  - 수신자는 항상 송신자의 하류에 있다고 말하는 것 같다.

### 메시지의 각 부분
- http 메시지
  - 시작줄, 헤더, 본문으로 이루어져 있다.
    - 어떤 메시지인지 서술하는 시작줄, 속성을 나타내는 헤더, 데이터를 나타내는 본문
  - 요청 메시지와 응답 메시지로 나뉜다.
    - 요청 메시지
      - 웹 서버에 어떤 동작을 요구
      - 명령과 url을 포함
        ```
        <메서드> <요청 URL> <버전>  // 시작줄
        <헤더>                   // 헤더

        <엔터티 본문>              // 본문
        ```
        ```http
        GET /test/hi-there.txt HTTP/1.1
        Accept: text/*
        Host: www.joes-hardware.com

        ```
    - 응답 메시지
      - 요청의 결과를 클라이언트에게 돌려준다.
      - 트랜잭션의 결과를 포함
        ```
        <버전> <상태 코드> <사유 구절>  // 시작줄
        <헤더>                      // 헤더

        <엔터티 본문>                 // 본문
        ```
        ```http
        HTTP/1.0 200 OK
        Content-type: text/plain
        Content-length: 19

        Hi! I'm a message!
        ```
- 시작줄
  - 요청 메시지 & 응답 메시지의 시작줄
    - 요청줄
      - 무엇을 해야하는지 말해준다.
      - 구성
        - [메서드](https://developer.mozilla.org/ko/docs/Web/HTTP/Methods)
          - 클라이언트 측에서 서버가 리소스에 대해 수행해주길 바라는 동작
        - 요청 url
          - 요청 대상이 되는 리소스를 지칭하는 완전한 url 혹은 url의 경로 구성요소
        - http 버전
          - 이 메시지에서 사용 중인 http의 버전
    - 응답줄
      - 무슨 일이 일어났는지 말해준다.
      - 구성
        - http 버전
          - 이 메시지에서 사용 중인 http의 버전
        - [상태 코드](https://developer.mozilla.org/ko/docs/Web/HTTP/Status)
          - 요청 중에 무엇이 일어났는지 클라이언트에게 설명하는 세 자리의 숫자
          - 첫 번째 자릿 수는 상태의 일반적인 분류를 나타낸다.
            - 1 : 정보
            - 2 : 성공
            - 3 : 리다이렉션
            - 4 : 클라이언트 에러
            - 5 : 서버 에러
        - 사유 구절
          - 상태 코드의 의미를 사람이 이해할 수 있게 설명해주는 짧은 문구
- [헤더](https://developer.mozilla.org/ko/docs/Web/HTTP/Headers)
  - 이름, 콜론(`:`), 선택적인 공백, 값, CRLF가 순서대로 나타나는 0개 이상의 헤더
    - 헤더의 목록은 빈줄(CRLF)로 끝나 헤더 목록의 끝과 엔터티 본문의 시작을 표시한다.
      ```
      Content-Type: image/gif
      Content-Length: 8572
      Sever: Test Server
        Version 1.0
      
      ```
  - 분류
    - 일반 헤더
      - 요청과 응답 양쪽에 모두 나타날 수 있음
    - 요청 헤더
      - 요청에 대한 부가 정보를 제공
    - 응답 헤더
      - 요청에 대한 부가 정보를 제공
    - Entity 헤더
      - 본문 크기와 콘텐츠, 혹은 리소스 그 자체를 서술
    - 확장 헤더
      - 명세에 정의되지 않은 새로운 헤더
- 엔터티 본문
  - 임의의 데이터 블록을 포함한다.
  - 모든 메시지가 엔터티 본문을 갖는 것은 아니다. 선택적이다.

### 메서드
- [HTTP 요청 메서드](https://developer.mozilla.org/ko/docs/Web/HTTP/Methods)

### 상태 코드
- [HTTP 상태 코드](https://developer.mozilla.org/ko/docs/Web/HTTP/Status)

### 헤더
- [HTTP 헤더](https://developer.mozilla.org/ko/docs/Web/HTTP/Headers)
  - 인증
    - Authorization
      - 서버와함께 유저 에이전트를 인증하기 위한 자격 증명을 포함합니다.
  - 캐싱
    - Age
      - 객체가 프록시 캐시에 있었던 초 단위의 시간.
    - Cache-Control
      - 요청과 응답 모두에서의 캐싱 메커니즘을 명시하는 지시문.
    - Expires
      - 응답이 만료되었다고 고려되는 날짜/시간.
    - Pragma
      - 요청-응답 체인을 따라 어디든 다양한 영향을 줄 수 있는 구현-관련 헤더. Cache-Control 헤더가 존재하지 않는 HTTP/1.0 캐시와의 하위 호환성을 위해 사용됨.
  - 조건부
    - Last-Modified
      - 동일한 리소스의 여러 버전을 비교하는데 사용되는 검사기로, 리소스의 마지막 수정 날짜입니다. ETag보다 덜 정확하지만, 어떤 환경에서는 계산이 더 쉽습니다. If-Modified-Since와 If-Unmodified-Since를 사용하는 조건부 요청은 이 값을 사용하여 요청의 동작을 변경합니다.
    - ETag
      - 리소스의 버전을 식별하는 고유한 문자열 검사기입니다. If-Match와 If-None-Match를 사용하는 조건부 요청은 이 값을 사용하여 요청의 동작을 변경합니다.
    - Vary
      - 오리진 서버로부터 새로운 요청을하는 대신 캐시된 응답을 사용할지를 결정하기위한 향후의 요청 헤더를 매칭할 방법을 정합니다.
  - 연결 관리
    - Connection
      - 현재 트랜잭션이 끝난후에 네트워크 연결을 열린 상태로 둘지 여부를 제어합니다.
    - Keep-Alive
      - 지속적인 연결이 열린 상태로 유지할 기간을 제어합니다.
  - 컨텐츠 협상
    - Accept
      - 돌려줄 데이터 타입에 대해 서버에 알립니다. MIME 타입입니다.
    - Accept-Charset
      - 클라이언트가 이해할 수 있는 문자 집합에 대해 서버에 알립니다.
    - Accept-Encoding
      - 인코딩 알고리즘에 대해 서버에 알립니다. 보통은 돌려줄 리소스에 사용되는 압축 알고리즘입니다.
    - Accept-Language
      - 서버가 돌려주기로 예상된 언어에 대해 서버에 알립니다. 이는 힌트이며 사용자의 모든 제어 아래에서는 필수가 아닙니다: 서버는 명시적인 사용자 선택을 덮어쓰지 않도록 항상 집중해야합니다(드롭 다운 리스트에서 언어를 선택하는 것처럼).
  - 제어
    - Expect
      - 요청을 적절히 처리하기위해 서버에서 수행되어야하는 기대치를 나타냅니다.
  - 쿠키
    - Cookie
      - Set-Cookie 헤더와 함께 서버로부터 이전에 전송됐던 저장된 HTTP 쿠키를 포함합니다. 
    - Set-Cookie
      - 서버에서 유저 에이전트로 쿠키를 전송합니다.
  - CORS
    - Access-Control-Allow-Origin
      - 응답이 공유될 수 있는지를 나타냅니다.
    - Access-Control-Allow-Credentials
      - credentials 플래그가 true일 때 요청에 대한 응답이 노출될 수 있는지를 나타냅니다.
    - Access-Control-Allow-Headers
      - 실제 요청을 만들 때 사용될 수 있는 HTTP 헤더를 나타내는 preflight 요청에 대한 응답으로 사용됩니다.
  - 추적 안함
    - DNT
      - 사용자의 추적 설정을 나타내는데 사용됩니다.
  - 메시지 바디 정보
    - Content-Length
      - 수신자에게 전송된 엔티티 바디의 크기를 10진수 바이트 단위로 나타냅니다.
    - Content-Type
      - 리소스의 미디어 타입을 나타냅니다.
    - Content-Encoding
      - 압축 알고리즘을 명시하는데 사용됩니다.
    - Content-Language
      - 사용자를 위한 언어를 설명하여 사용자가 선호하는 언어에 따라 구분할 수 있게해줍니다.
    - Content-Location
      - 반환된 데이터를 위한 대체 위치를 나타냅니다.
  - 프록시
    - Forwarded
      - 프록시가 요청의 경로에 포함될 때 변경되거나 손실되는 프록시 서버의 클라이언트 측면에 대한 정보를 포함합니다.
    - X-Forwarded-For 
      - HTTP 프록시나 로드 밸런서를 통해 웹 서버로 연결하는 클라이언트의 시작 IP 주소를 확인합니다.
    - X-Forwarded-Proto 
      - 클라이언트가 여러분의 프록시나 로드 밸런서에 접속하기 위해 사용했던 프로토콜(HTTP 또는 HTTPS)을 확인합니다.
  - 요청 컨텍스트
    - From
      - 요청하는 유저 에이전트를 제어하는 사용자(사람)의 인터넷 이메일 주소를 포함합니다.
    - Host
      - 서버(가상 호스팅용)의 도메인명과 (선택적으로) 서버가 리스닝중인 TCP 포트 번호를 명시합니다.
    - Referer
      - 현재 페이지로 연결되는 링크가 있던 이전 웹 페이지의 주소입니다.
  - 응답 컨텍스트
    - Server
      - 요청을 처리하기 위해 오리진 서버에 의해 사용되는 소프트웨어에 대한 정보를 포함합니다.
  - 범위 요청
    - Accept-Ranges
      - 서버가 범위 요청을 지원하는지를 나타내며, 지원할 경우 범위가 표현될 수 있는 단위를 나타냅니다.
    - Range
      - 서버가 반환해야하는 문서의 부분을 나타냅니다.
    - If-Range
      - 주어진 etag 또는 날짜가 원격 리소스와 일치할 경우에만 수행되는 조건적 범위 요청을 생성합니다. 호환되지 않는 범전의 리소스에서 두 가지 범위의 다운로드를 방지하기위해 사용됩니다.
    - Content-Range
      - 전체 바디 메시지 중 특정 메시지가 포함된 위치를 나타냅니다.
  - 보안
    - Content-Security-Policy (CSP)
      - 주어진 페이지에 대해 유저 에이전트가 로드할 수 있는 리소스를 제어합니다.
    - Strict-Transport-Security (HSTS)
      - HTTP 대신 HTTPS를 사용하여 통신하도록 강제합니다.
    - X-Frame-Options (XFO)
      - 브라우저가 `<frame>, <iframe>, <embed>` 또는 `<object>`에서 페이지 렌더링을 허용해야하는지를 나타냅니다.
    - X-XSS-Protection
      - 교차-사이트 스크립팅 필터링을 활성화합니다.
  - 전송 코딩
    - Transfer-Encoding
      - 사용자에게 엔티티를 안전하게 전송하기위해 사용할 인코딩 형식을 지정합니다.
  - 그 외
    - Date
      - 메시지가 발생한 날짜와 시간을 포함합니다.
    - Retry-After
      - 유저 에이전트가 다음 요청을 생성하기전에 얼마나 기다려야하는지를 나타냅니다.
